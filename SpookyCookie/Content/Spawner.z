class Spawner : ZilchComponent
{
    [Property]
    var DistanceSpawn : Real;
    [Property]
    var TargetPath : CogPath;
    var Target : Cog;
    [Property]
    var DetectDistance : Real;
    [Property]
    var RespawnTime : Real;
    
    var HasSpawned : Boolean = false;
    var Ghost : Cog = null;
    
    var Time : Real;
    function Initialize(init : CogInitializer)
    {
        Zero.Connect(this.Space, Events.LogicUpdate, this.OnLogicUpdate);
        if(this.TargetPath != null)
            this.Target = this.TargetPath.Cog;
        
    }

    function OnLogicUpdate(event : UpdateEvent)
    {
        var dist = Math.Distance(this.Owner.Transform.Translation.XY, this.Target.Transform.Translation.XY);
        //Console.WriteLine("`dist`-`this.DetectDistance`");
        if(this.Time > 0)
        {
            this.Time -= event.Dt;
            if (this.Time <= 0)
                this.Time = 0;
            else
                return;
        }
        if(this.HasSpawned && this.Ghost == null)
        {
            Console.WriteLine("?");
            this.HasSpawned = false;
            this.Time = this.RespawnTime;
            return;
        }
        if(dist < this.DetectDistance && !this.HasSpawned)
        {
            Console.WriteLine("!");
            this.Ghost = this.Space.CreateAtPosition(Archetype.Ghost,this.Owner.Transform.Translation);
            this.Ghost.MonsterAI.Target = this.Target;
            this.HasSpawned = true;
        }
    }
}